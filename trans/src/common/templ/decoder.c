/* $Id$ */

/*
 * Copyright 2002-2011, The TenDRA Project.
 * Copyright 1997, United Kingdom Secretary of State for Defence.
 *
 * See doc/copyright/ for the full copyright terms.
 */

/* AUTOMATICALLY GENERATED BY %ZX VERSION %ZV FROM TDF %VA.%VB */

#include <shared/check.h>

#include <tdf/nat.h>
#include <tdf/ecodes.h>

#include <reader/basicread.h>
#include <reader/externs.h>
#include <reader/messages_r.h>
#include <reader/main_reads.h>

#include <refactor/refactor.h>


/* REPORT AN ERROR */

static void
decode_error(char *s)
{
    error(ERR_INTERNAL, s);
    exit(EXIT_FAILURE);
}
@use all
@special exp
@special nat computed_nat
@special signed_nat computed_signed_nat
@special tagdef make_var_tagdef
@special tagdef common_tagdef
@loop sort
@if !sort.builtin


/* DECODE %ST */

%SN
d_%SN(void)
{
@if sort.basic
@if sort.extends
    int code = get_big_code(%SB);
@else
    int code = getcode(%SB);
@endif
    switch (code) {
@loop sort.cons
	case e_%CN: {
@if cons.params
@loop cons.param
	    %PSN p%PE;
@end
@loop cons.param
@if param.align
	    to_boundary();
@endif
@if param.break
@if param.first
	    start_%CN();
@else
	    start_%CN(%
@loop param.prev
 p%PE,%
@end
%b);
@endif
@endif
@if param.sort.special
@if cons.cond
	    p%PE = hold_const_refactor(d_%PSN());
@else
@if cons.special
	    p%PE = hold_const_refactor(d_%PSN());
@else
	    p%PE = hold_refactor(d_%PSN());
@endif
@endif
@else
	    p%PE = d_%PSN();
@endif
@end
	    return f_%CN(%
@loop cons.param
 p%PE,%
@end
%b);
@else
@if sort.special
	    return f_%CN();
@else
	    return f_%CN;
@endif
@endif
	}
@end
    }
    decode_error(ILLEGAL_CODE_%SN);
    return f_dummy_%SN;
@else
@if sort.dummy
@loop sort.cons
@loop cons.param
    %PSN p%PE;
@end
@loop cons.param
@if param.align
    to_boundary();
@endif
@if param.break
    start_%CN(%
@loop param.prev
 p%PE,%
@end
%b);
@endif
@if param.sort.special
    p%PE = hold_refactor(d_%PSN());
@else
    p%PE = d_%PSN();
@endif
@end
    return f_%CN(%
@loop cons.param
 p%PE,%
@end
%b);
@end
@else
@if sort.option
    if (getcode(1)) {
	%SSN e;
@if sort.sub.special
	e = hold_refactor(d_%SSN());
@else
	e = d_%SSN();
@endif
	return yes_%SN(e);
    }
    return no_%SN;
@else
    int i, n;
    %SN temp;
@if sort.list
    IGNORE getcode(1);
@endif
    n = small_dtdfint();
    temp = new_%SN(n);
    for (i = 0; i < n; i++) {
	%SSN e;
@if sort.sub.special
	e = hold_refactor(d_%SSN());
@else
	e = d_%SSN();
@endif
	temp = add_%SN(temp, e, i);
    }
    return temp;
@endif
@endif
@endif
}
@endif
@end
